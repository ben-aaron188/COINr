<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Treat a data set in a coin for outliers — Treat.coin • COINr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Treat a data set in a coin for outliers — Treat.coin"><meta property="og:description" content="Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. This function is set up to allow any functions to be passed as the
data treatment functions (f1 and f2), as well as any function to be passed as the outlier detection
function f_pass. The data set in the coin to be treated is specified by dset."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">COINr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/adjustments.html">Adjustments and Comparisons</a>
    </li>
    <li>
      <a href="../articles/aggregate.html">Aggregation</a>
    </li>
    <li>
      <a href="../articles/analysis.html">Analysis</a>
    </li>
    <li>
      <a href="../articles/coins.html">Building coins</a>
    </li>
    <li>
      <a href="../articles/data_selection.html">Data selection</a>
    </li>
    <li>
      <a href="../articles/denomination.html">Denomination</a>
    </li>
    <li>
      <a href="../articles/imputation.html">Imputation</a>
    </li>
    <li>
      <a href="../articles/normalise.html">Normalisation</a>
    </li>
    <li>
      <a href="../articles/other_functions.html">Other Functions</a>
    </li>
    <li>
      <a href="../articles/overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/panel_data.html">Panel Data</a>
    </li>
    <li>
      <a href="../articles/results.html">Presenting Results</a>
    </li>
    <li>
      <a href="../articles/screening.html">Unit Screening</a>
    </li>
    <li>
      <a href="../articles/sensitivity.html">Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/treat.html">Outlier Treatment</a>
    </li>
    <li>
      <a href="../articles/v1.html">Changes from COINr v1.0.0</a>
    </li>
    <li>
      <a href="../articles/visualisation.html">Visualisation</a>
    </li>
    <li>
      <a href="../articles/weights.html">Weights</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bluefoxr/COINr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Treat a data set in a coin for outliers</h1>
    <small class="dont-index">Source: <a href="https://github.com/bluefoxr/COINr/blob/HEAD/R/treat.R" class="external-link"><code>R/treat.R</code></a></small>
    <div class="hidden name"><code>Treat.coin.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. This function is set up to allow any functions to be passed as the
data treatment functions (<code>f1</code> and <code>f2</code>), as well as any function to be passed as the outlier detection
function <code>f_pass</code>. The data set in the coin to be treated is specified by <code>dset</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># S3 method for coin</span>
<span class="fu"><a href="Treat.html">Treat</a></span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">dset</span>,
  global_specs <span class="op">=</span> <span class="cn">NULL</span>,
  indiv_specs <span class="op">=</span> <span class="cn">NULL</span>,
  combine_treat <span class="op">=</span> <span class="cn">FALSE</span>,
  out2 <span class="op">=</span> <span class="st">"coin"</span>,
  write_to <span class="op">=</span> <span class="cn">NULL</span>,
  write2log <span class="op">=</span> <span class="cn">TRUE</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A coin</p></dd>


<dt>dset</dt>
<dd><p>A named data set available in <code>.$Data</code></p></dd>


<dt>global_specs</dt>
<dd><p>Default specifications</p></dd>


<dt>indiv_specs</dt>
<dd><p>Individual specifications</p></dd>


<dt>combine_treat</dt>
<dd><p>By default, if <code>f1</code> fails to pass <code>f_pass</code>, then <code>f2</code> is applied to the original <code>x</code>,
rather than the treated output of <code>f1</code>. If <code>combine_treat = TRUE</code>, <code>f2</code> will instead be applied to the output
of <code>f1</code>, so the two treatments will be combined.</p></dd>


<dt>out2</dt>
<dd><p>The type of function output: either <code>"coin"</code> to return an updated coin, or <code>"list"</code> to return a
list with treated data and treatment details.</p></dd>


<dt>write_to</dt>
<dd><p>If specified, writes the aggregated data to <code>.$Data[[write_to]]</code>. Default <code>write_to = "Treated"</code>.</p></dd>


<dt>write2log</dt>
<dd><p>Logical: if <code>FALSE</code>, the arguments of this function are not written to the coin log, so this
function will not be invoked when regenerating. Recommend to keep <code>TRUE</code> unless you have a good reason to do otherwise.</p></dd>


<dt>...</dt>
<dd><p>arguments passed to or from other methods.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An updated coin with a new data set <code>.Data$Treated</code> added, plus analysis information in
<code>.$Analysis$Treated</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The arrangement of this function is inspired by a fairly standard data treatment process applied to
indicators, which consists of checking skew and kurtosis, then if the criteria are not met, applying
Winsorisation up to a specified limit. Then if Winsorisation still does not bring skew and kurtosis
within limits, applying a nonlinear transformation such as log or Box-Cox.</p>
<p>This function generalises this process by using the following general steps:</p><ol><li><p>Check if variable passes or fails using <code>f_pass</code></p></li>
<li><p>If <code>f_pass</code> returns <code>FALSE</code>, apply <code>f1</code>, else return <code>x</code> unmodified</p></li>
<li><p>Check again using *<code>f_pass</code></p></li>
<li><p>If <code>f_pass</code> still returns <code>FALSE</code>, apply <code>f2</code></p></li>
<li><p>Return the modified <code>x</code> as well as other information.</p></li>
</ol><p>For the "typical" case described above <code>f1</code> is a Winsorisation function, <code>f2</code> is a nonlinear transformation
and <code>f_pass</code> is a skew and kurtosis check. Parameters can be passed to each of these three functions in
a named list, for example to specify a maximum number of points to Winsorise, or Box-Cox parameters, or anything
else. The constraints are that:</p><ul><li><p>All of <code>f1</code>, <code>f2</code> and <code>f_pass</code> must follow the format <code>function(x, f_para)</code>, where <code>x</code> is a
numerical vector, and <code>f_para</code> is a list of other function parameters to be passed to the function, which
is specified by <code>f1_para</code> for <code>f1</code> and similarly for the other functions. If the function has no parameters
other than <code>x</code>, then <code>f_para</code> can be omitted.</p></li>
<li><p><code>f1</code> and <code>f2</code> should return either a list with <code>.$x</code> as the modified numerical vector, and any other information
to be attached to the list, OR, simply <code>x</code> as the only output.</p></li>
<li><p><code>f_pass</code> must return a logical value, where <code>TRUE</code> indicates that the <code>x</code> passes the criteria (and
therefore doesn't need any (more) treatment), and <code>FALSE</code> means that it fails to meet the criteria.</p></li>
</ul><p>See also <code><a href="../articles/treat.html">vignette("treat")</a></code>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># build example coin</span></span>
<span class="r-in"><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="build_example_coin.html">build_example_coin</a></span><span class="op">(</span>up_to <span class="op">=</span> <span class="st">"new_coin"</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iData checked and OK.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iMeta checked and OK.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Written data set to .$Data$Raw</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># treat raw data set</span></span>
<span class="r-in"><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="Treat.html">Treat</a></span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Raw"</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Written data set to .$Data$Treated</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># summary of treatment for each indicator</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coin</span><span class="op">$</span><span class="va">Analysis</span><span class="op">$</span><span class="va">Treated</span><span class="op">$</span><span class="va">Dets_Table</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     iCode check_SkewKurt0.Pass check_SkewKurt0.Skew check_SkewKurt0.Kurt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     LPI                 TRUE           -0.3042681           -0.6567514</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Flights                FALSE            2.1032872            4.5088794</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    Ship                 TRUE           -0.5756680           -0.6814795</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    Bord                FALSE            2.1482360            5.7914905</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    Elec                FALSE            2.2252736            5.7910268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     Gas                FALSE            2.8294486           10.3346494</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   winsorise.nwin check_SkewKurt1.Pass check_SkewKurt1.Skew check_SkewKurt1.Kurt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             NA                   NA                   NA                   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              1                 TRUE             1.900658             3.336065</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             NA                   NA                   NA                   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4              1                 TRUE             1.899211             4.346298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5              1                 TRUE             1.717744             2.586062</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6              1                 TRUE             1.602518             1.525576</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by William Becker.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer></div>

  


  

  </body></html>

